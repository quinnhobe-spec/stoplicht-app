<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Stoplicht - leerling</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:Arial,Helvetica,sans-serif;padding:20px;max-width:720px;margin:auto}
.buttons button{display:block;width:100%;padding:14px;margin:8px 0;font-size:18px;border:none;border-radius:8px;color:white;cursor:pointer}
.red{background:#d9534f}
.orange{background:#f0ad4e;color:#222}
.green{background:#5cb85c}
.q{background:#5bc0de;color:#022}
.status-list{margin-top:18px;padding:0;list-style:none;display:flex;flex-wrap:wrap;gap:8px}
.status-item{display:flex;align-items:center;padding:8px 10px;border-radius:8px;background:#f7f7f7;min-width:180px}
.dot{width:16px;height:16px;border-radius:50%;margin-right:10px;flex:0 0 16px}
.meta{font-size:12px;color:#444;margin-left:auto}
#msg{margin-top:12px}
</style>
</head>
<body>
<h2>Stoplicht - leerling</h2>

<label for="studentName">Kies je naam</label>
<select id="studentName" aria-label="Student naam"></select>

<div class="buttons" role="group" aria-label="Stoplicht knoppen">
    <button class="red" data-status="red">üü• Ik heb direct hulp nodig</button>
    <button class="orange" data-status="orange">üüß Ik twijfel</button>
    <button class="green" data-status="green">üü© Ik kan verder</button>
    <button class="q" data-status="question">‚ùì Ik heb een vraag</button>
</div>

<p id="msg" style="color:green" aria-live="polite"></p>

<h3>Huidige status klas</h3>
<ul id="statusList" class="status-list" aria-live="polite"></ul>

<!-- Firebase compat libs (keeps original code style) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// --- Vervang hieronder door jouw Firebase config ---
const firebaseConfig = {
  apiKey: "AIzaSyC8wWU5VUq6YLNzxBObFuVN8WYegKzZTPI",
  authDomain: "stoplichtblokje.firebaseapp.com",
  projectId: "stoplichtblokje",
  storageBucket: "stoplichtblokje.firebasestorage.app",
  messagingSenderId: "1019644227104",
  appId: "1:1019644227104:web:833b07ad778a8df5171645",
  measurementId: "G-3MG6YRBVD2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Voorbeeld klas ‚Äî vervang of haal dynamisch op als nodig
const klas = ["Anna","Bilal","Cas"];
const sel = document.getElementById('studentName');
klas.forEach(n=>{
    const opt = document.createElement('option');
    opt.value = n.toLowerCase();
    opt.textContent = n;
    sel.appendChild(opt);
});

// Utility: leesbare tijd
function timeAgo(ts){
    if(!ts) return '';
    const diff = Math.floor((Date.now() - ts)/1000);
    if(diff < 5) return 'nu';
    if(diff < 60) return diff + 's';
    if(diff < 3600) return Math.floor(diff/60) + 'm';
    if(diff < 86400) return Math.floor(diff/3600) + 'u';
    return new Date(ts).toLocaleString();
}

// Update status in realtime DB
function updateStatus(id,name,status){
    db.ref('students/'+id).set({
        name: name,
        status: status,
        timestamp: Date.now()
    }, err=>{
        const msg = document.getElementById('msg');
        msg.textContent = err ? 'Fout bij opslaan' : 'Status opgeslagen: '+status;
        msg.style.color = err ? 'crimson' : 'green';
        setTimeout(()=>{ msg.textContent = ''; }, 2500);
    });
}

// Buttons
document.querySelectorAll('.buttons button').forEach(b=>{
    b.addEventListener('click', ()=>{
        if(!sel.value) return;
        const status = b.dataset.status;
        const id = sel.value;
        const name = sel.options[sel.selectedIndex].text;
        updateStatus(id,name,status);
    });
});

// Render klasstatussen
const statusList = document.getElementById('statusList');
function renderStatuses(snapshot){
    const data = snapshot.val() || {};
    // ensure order: klas array first, then others
    const keys = [...klas.map(n=>n.toLowerCase()), ...Object.keys(data).filter(k=>!klas.map(n=>n.toLowerCase()).includes(k))];
    statusList.innerHTML = '';
    keys.forEach(k=>{
        const s = data[k] || {name: k, status: 'unknown', timestamp: null};
        const li = document.createElement('li');
        li.className = 'status-item';
        const dot = document.createElement('div');
        dot.className = 'dot';
        if(s.status === 'red') dot.style.background = '#d9534f';
        else if(s.status === 'orange') dot.style.background = '#f0ad4e';
        else if(s.status === 'green') dot.style.background = '#5cb85c';
        else if(s.status === 'question') dot.style.background = '#5bc0de';
        else dot.style.background = '#bbb';
        const name = document.createElement('div');
        name.textContent = s.name || k;
        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.textContent = s.timestamp ? timeAgo(s.timestamp) : '';
        li.appendChild(dot);
        li.appendChild(name);
        li.appendChild(meta);
        statusList.appendChild(li);
    });
}

// Listen for realtime changes
db.ref('students').on('value', renderStatuses);

// Optional: show selected student's current status when selection changes
sel.addEventListener('change', ()=>{
    const id = sel.value;
    if(!id) return;
    db.ref('students/'+id).get().then(snap=>{
        const v = snap.val();
        const msgEl = document.getElementById('msg');
        if(v) msgEl.textContent = 'Huidige status: ' + v.status + (v.timestamp ? ' ('+timeAgo(v.timestamp)+')' : '');
        else msgEl.textContent = 'Nog geen status gezet';
        setTimeout(()=>{ msgEl.textContent = ''; }, 3000);
    });
});
</script>
</body>
</html>