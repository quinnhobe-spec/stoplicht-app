<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Stoplicht - leerling</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body {font-family: Arial,sans-serif; padding:20px; max-width:720px; margin:auto; background:#f5f5f5;}
h2 {text-align:center;}
.buttons {display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:20px;}
.buttons button {flex:1 1 120px; padding:14px; font-size:18px; border:none; border-radius:8px; color:white; cursor:pointer;}
.red {background:#d9534f;}
.green {background:#5cb85c;}
.overlay {position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; flex-wrap:wrap; padding:20px; z-index:10;}
.overlay button {flex:1 1 100px; margin:10px;}
#logoutBtn {margin-top:20px; padding:10px 16px; background:#ccc; color:#000; border-radius:6px; cursor:pointer;}
</style>
</head>
<body>
<h2>Stoplicht Leerling</h2>

<div id="loginOverlay" class="overlay"></div>

<div class="buttons" role="group" aria-label="Stoplicht knoppen">
    <button class="green" data-status="aanhetwerk">ðŸŸ© Aan het werk / Geen vragen</button>
    <button class="red" data-status="vraag">ðŸŸ¥ Ik heb een vraag</button>
</div>

<button id="logoutBtn">Uitloggen</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyC8wWU5VUq6YLNzxBObFuVN8WYegKzZTPI",
  authDomain: "stoplichtblokje.firebaseapp.com",
  databaseURL: "https://stoplichtblokje-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "stoplichtblokje",
  storageBucket: "stoplichtblokje.firebasedestorage.app",
  messagingSenderId: "1019644227104",
  appId: "1:1019644227104:web:833b07ad778a8df5171645"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentUser=null;
const overlay=document.getElementById('loginOverlay');
const buttons=document.querySelectorAll('.buttons button');
const logoutBtn=document.getElementById('logoutBtn');

function loadStudents(){
    overlay.innerHTML='';
    db.ref('students').once('value').then(snap=>{
        const data=snap.val()||{};
        // Check start of day message
        db.ref('class/startOfDayMessage').once('value').then(msgSnap=>{
            const msgData = msgSnap.val();
            if(msgData && msgData.message){
                const p=document.createElement('p');
                p.style.color='#fff';
                p.style.fontSize='18px';
                p.style.width='100%';
                p.style.textAlign='center';
                p.textContent=msgData.message;
                overlay.appendChild(p);
            }
            Object.keys(data).forEach(k=>{
                const btn=document.createElement('button');
                btn.textContent=data[k].name;
                btn.addEventListener('click',()=>{
                    currentUser=k;
                    overlay.style.display='none';
                });
                overlay.appendChild(btn);
            });
            overlay.style.display='flex';
        });
    });
}

buttons.forEach(b=>{
    b.addEventListener('click', ()=>{
        if(!currentUser) return;
        const status=b.dataset.status;
        db.ref('students/'+currentUser).update({status:status});
    });
});

logoutBtn.addEventListener('click', ()=>{
    currentUser=null;
    overlay.style.display='flex';
});

loadStudents();
</script>
</body>
</html>
